+++
title = "個人サイトを作った"
date = 2023-07-22
draft = true
[taxonomies]
tags = ["パソカタ", "zola", "web"]
+++

ZolaというSSGでこのサイトを作った話。

<!-- more -->

## 動機

<mark>todo!("Twitterの様子を書く")</mark>

- [こんなツイート](https://twitter.com/elonmusk/status/1675315530725556224)をRTしたりしている、カスの猫バンバン？

- これを書いている間に𝕏になった。は？
- スパムはしぶとく生き残っている

そして、Twitterの雲行きが怪しくなっていくにつれ、インターネットに住処を構えるための代替手段として、Fediverseや ***TRUTH*** に加えて個人サイトが話題に上がっているのを見かけた。それをきっかけにそろそろ個人サイトを持つ歳か……という気持ちになったわけです。もちろん、投稿のコストやら交流の発生やらを考えると個人サイトはTwitterの完全な代替にはならないわけだが、せっかくの機会なのでいっちょやっていきましょう。

## ツール選定
私にはweb周りの技術というものが全くわからない、人一倍なにかに敏感ということもない。要するに、Reactやらなんとか.jsやら目薬のロゴみたいなやつやら、あの辺のカッチョ良さそうなフレームワークは全くわからない。webフレームワークの使用経験といえばRust製の[Yew](https://yew.rs/)というフレームワークで極めてシンプルなwebアプリを作成したことがあるだけである。

そして、この手の活動は始めの歩みが重いと完成が絶望的になる。そういうわけで、個人サイトの範疇では十分であろうから、SSGを使うことにした。しかし、SSGと言ってもそれはそれで様々な種類があるらしい、[Hugo](https://gohugo.io/)とかは聞いたことがあるな。とりあえず、コンテンツの基本をMarkdownで書けさえすれば最低限の引っ越しにはそれほど困らないだろうから、その条件だけを考えることにした。で、どうやらRust製の[Zola](https://www.getzola.org/)なるSSGがあるらしい。Rustならまぁプロジェクトが爆発したりしてもリポジトリからゴニョゴニョしてローカルにビルド環境を建てるとかそういう芸当ができるので、これに決定。

## 作る

### テーマの選定
いきなりテーマに行くのかと思うかもしれないが、実はそう突飛な話でもない。サイトの形式はテーマにかなり左右されるし、コンテンツの構造(つまり、`/content`以下の構造)はせいぜいブログとプロフィールページを設けるくらいなので特に考えることもない。

Zolaのサイトには[テーマを紹介しているページ](https://www.getzola.org/themes/)がある。そこに載っているテーマをザッピングしながらしばらく唸った後に[PaperMod](https://www.getzola.org/themes/papermod/)を使用することにした。どうやら元はHugo向けのテーマらしい。

### テーマを書き換える
テーマは`config.toml`である程度カスタマイズ出来るのだが、それでも足りないことがある。ホームに表示する投稿の件数だとか、`/content`以下のディレクトリ名をサンプルから変更したのに対応させたりだとか。あと、ページネーションの結果が複数ページになったとき、それらの間を遷移する方法がなかったので、それを実装した。ZolaのドキュメントにあったサンプルコードをStack Overflowした{{ fnref(index=0) }}だけなのにスタイルが適用されたときはびっくりになったが、元のHugoのテーマとしてPaperModもこのボタンに`pagination`というクラス名を割り当てていたらしい。

### 脚注を作る
Zolaでは[CommonMark](https://commonmark.org/)を食べる[pulldown-cmark](https://github.com/raphlinus/pulldown-cmark#pulldown-cmark)というパーサを用いている{{ fnref(index=5) }}らしいが、生成された脚注{{ fnref(index=2) }}が無駄にスペースを取ったり本文に戻れなかったりとあまり使い心地が良くなかった。パーサが吐いたHTMLをいじくり回す方法が分からなかったので、ショートコードで自前実装した。ただ、この方法には欠点がある。というのも、Markdownの脚注で使用するタグ名は対応関係のみを指定するもので、コンパイルすると出現した順番で勝手に番号になる優しさがあるが、自前実装したものは`index`の値がそのまま注釈名になる。つまり、脚注が出現した順に番号がつくようにしたい時、途中に挿入するのに弱い。まあ数字以外の注釈を使えるという裏仕様{{ fnref(index="仕様？") }}もあるのだが。

## デプロイ

todo!()

---

{{ fndef(index=0,content="ドキュメントもMITライセンス下で公開されていた") }}

{{ fndef(index=5,content="Markdownの仕様はいたる所で乱立しており、コンパネと設定の南北朝とかそんな生易しいものではない

> Because there is no unambiguous spec, implementations have diverged considerably over the last 10 years. 
>
> — <cite>[Why is CommonMark needed?](https://commonmark.org/)</cite>

") }}

{{ fndef(index=2,content="CommonMarkの仕様をざっと読んだところ、どうやら脚注のみに使用する機能では無さそうではあった") }}

{{ fndef(index="仕様？",content="こんなこともできる、Wikipediaの <sup>[*誰?*]</sup> みたいだ") }}
